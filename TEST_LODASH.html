<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lodash CDN 测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>🧪 Lodash CDN 测试页面</h1>
    
    <div class="test-section">
        <h2>CDN URL 测试</h2>
        <div id="cdn-test-results"></div>
        
        <h3>测试的CDN URL:</h3>
        <ul>
            <li>✅ <strong>正确URL</strong>: https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js</li>
            <li>❌ <strong>错误URL</strong>: https://unpkg.com/lodash@4.17.21/dist/index.umd.js</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>Lodash 功能测试</h2>
        <button class="test-button" onclick="testLodashFunctions()">🧪 测试 Lodash 功能</button>
        <div id="lodash-test-results"></div>
    </div>

    <div class="test-section">
        <h2>其他CDN测试</h2>
        <button class="test-button" onclick="testOtherCDNs()">🔗 测试其他包的CDN</button>
        <div id="other-cdn-results"></div>
    </div>

    <!-- 加载正确的 Lodash CDN -->
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
    
    <script>
        // 测试CDN URL可访问性
        async function testCDNUrls() {
            const urls = [
                {
                    name: '正确的 Lodash URL (jsdelivr)',
                    url: 'https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js',
                    shouldWork: true
                },
                {
                    name: '错误的 Lodash URL (unpkg)',
                    url: 'https://unpkg.com/lodash@4.17.21/dist/index.umd.js',
                    shouldWork: false
                }
            ];

            const resultsDiv = document.getElementById('cdn-test-results');
            resultsDiv.innerHTML = '<p>正在测试CDN URL...</p>';

            let results = '';
            
            for (const test of urls) {
                try {
                    const response = await fetch(test.url, { method: 'HEAD' });
                    const success = response.ok;
                    const status = success ? '✅ 可访问' : '❌ 不可访问';
                    const cssClass = success ? 'success' : 'error';
                    
                    results += `
                        <div class="test-result ${cssClass}">
                            <strong>${test.name}</strong><br>
                            URL: ${test.url}<br>
                            状态: ${status} (${response.status})
                        </div>
                    `;
                } catch (error) {
                    results += `
                        <div class="test-result error">
                            <strong>${test.name}</strong><br>
                            URL: ${test.url}<br>
                            状态: ❌ 网络错误 - ${error.message}
                        </div>
                    `;
                }
            }
            
            resultsDiv.innerHTML = results;
        }

        // 测试 Lodash 功能
        function testLodashFunctions() {
            const resultsDiv = document.getElementById('lodash-test-results');
            
            if (typeof _ === 'undefined') {
                resultsDiv.innerHTML = `
                    <div class="test-result error">
                        ❌ Lodash 未加载！请检查CDN URL是否正确。
                    </div>
                `;
                return;
            }

            try {
                // 测试各种 Lodash 功能
                const tests = [
                    {
                        name: '数组打乱 (_.shuffle)',
                        test: () => _.shuffle([1, 2, 3, 4, 5]),
                        expected: '长度为5的数组'
                    },
                    {
                        name: '数组去重 (_.uniq)',
                        test: () => _.uniq([1, 2, 2, 3, 3, 4]),
                        expected: '[1, 2, 3, 4]'
                    },
                    {
                        name: '深克隆 (_.cloneDeep)',
                        test: () => _.cloneDeep({a: {b: 1}}),
                        expected: '深拷贝对象'
                    },
                    {
                        name: '防抖函数 (_.debounce)',
                        test: () => typeof _.debounce(() => {}, 100),
                        expected: 'function'
                    },
                    {
                        name: '对象按属性排序 (_.sortBy)',
                        test: () => _.sortBy([{a: 2}, {a: 1}], 'a'),
                        expected: '按a属性排序的数组'
                    }
                ];

                let results = '<div class="test-result success">✅ Lodash 加载成功！版本: ' + _.VERSION + '</div>';
                
                tests.forEach(test => {
                    try {
                        const result = test.test();
                        results += `
                            <div class="test-result success">
                                ✅ <strong>${test.name}</strong><br>
                                结果: <code>${JSON.stringify(result)}</code><br>
                                预期: ${test.expected}
                            </div>
                        `;
                    } catch (error) {
                        results += `
                            <div class="test-result error">
                                ❌ <strong>${test.name}</strong><br>
                                错误: ${error.message}
                            </div>
                        `;
                    }
                });

                resultsDiv.innerHTML = results;
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="test-result error">
                        ❌ 测试过程出错: ${error.message}
                    </div>
                `;
            }
        }

        // 测试其他包的CDN
        async function testOtherCDNs() {
            const resultsDiv = document.getElementById('other-cdn-results');
            resultsDiv.innerHTML = '<p>正在测试其他包的CDN URL...</p>';

            const packages = [
                {
                    name: 'axios',
                    url: 'https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js'
                },
                {
                    name: 'moment',
                    url: 'https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js'
                },
                {
                    name: 'uuid',
                    url: 'https://cdn.jsdelivr.net/npm/uuid@9.0.1/dist/umd/uuid.min.js'
                }
            ];

            let results = '';
            
            for (const pkg of packages) {
                try {
                    const response = await fetch(pkg.url, { method: 'HEAD' });
                    const success = response.ok;
                    const status = success ? '✅ 可访问' : '❌ 不可访问';
                    const cssClass = success ? 'success' : 'error';
                    
                    results += `
                        <div class="test-result ${cssClass}">
                            <strong>${pkg.name}</strong><br>
                            URL: ${pkg.url}<br>
                            状态: ${status}
                        </div>
                    `;
                } catch (error) {
                    results += `
                        <div class="test-result error">
                            <strong>${pkg.name}</strong><br>
                            URL: ${pkg.url}<br>
                            状态: ❌ 网络错误
                        </div>
                    `;
                }
            }
            
            resultsDiv.innerHTML = results;
        }

        // 页面加载完成后自动测试CDN
        window.addEventListener('load', () => {
            testCDNUrls();
            
            // 检查 Lodash 是否已加载
            setTimeout(() => {
                if (typeof _ !== 'undefined') {
                    document.getElementById('lodash-test-results').innerHTML = `
                        <div class="test-result success">
                            ✅ Lodash 自动加载成功！版本: ${_.VERSION}<br>
                            点击上方按钮进行功能测试
                        </div>
                    `;
                } else {
                    document.getElementById('lodash-test-results').innerHTML = `
                        <div class="test-result error">
                            ❌ Lodash 未自动加载，请检查网络连接
                        </div>
                    `;
                }
            }, 1000);
        });
    </script>
</body>
</html> 